{% extends "base.html.twig" %}
{% block title %}Добавить объявление{% endblock %}
{% block body %}
{% include 'header.html.twig' %}
{% include 'nav.html.twig' %}
<div class="uk-panel uk-margin">
    <div class="uk-container uk-margin uk-width-xxlarge">
        <form class="uk-form-horizontal uk-margin-large" action="" method="POST">
            <input type="hidden" value="{{session_id}}" name="session_id" ng-model="session_id_model" >
            <div class="uk-margin">
                <label class="uk-form-label" for="for-horizontal-text">{% trans %}Заголовок{% endtrans %}</label>
                <div class="uk-form-controls">
                    <input name="title" required class="uk-input" id="form-horizontal-text" type="text" placeholder="">
                </div>
            </div>
            <div class="uk-margin">
                <label class="uk-form-label" for="for-horizontal-text">{% trans %}Раздел{% endtrans %}</label>
                <div class="uk-form-controls">
                    <select class="uk-select" required name="section_id" id="form-horizontal-select">
                        <option value="0">Пусто</option>
                        {% for section in  sections %}
                            <option value="{{ section.id}}">{{section.name}}</option>
                        {% endfor%}
                    </select>
                </div>
            </div>
            <div class="uk-margin">
                <label class="uk-form-label" for="for-horizontal-text">{% trans %}Категория{% endtrans %}</label>
                <div class="uk-form-controls">
                    <select class="uk-select" required name="category_id" id="form-horizontal-select">
                        <option value="0">Пусто</option>
                        {% for category in  categories %}
                            <option value="{{ category.id}}">{{category.name}}</option>
                        {% endfor%}
                    </select>
                </div>
            </div>
            <div class="uk-margin">
                <label class="uk-form-label" for="for-horizontal-text">{% trans %}Мои магазины{% endtrans %}</label>
                <div class="uk-form-controls">
                    {{ render(controller('AppBundle:Company:usercompany')) }}
                </div>
            </div>
            <div class="uk-margin">
                <label class="uk-form-label" for="for-horizontal-text">{% trans %}Цена{% endtrans %}</label>
                <div class="uk-form-controls">
                    <input name="price" class="uk-input" id="form-horizontal-text" type="text">
                </div>
            </div>
            <div class="uk-margin">
                <label class="uk-form-label" for="for-horizontal-text">{% trans %}Валюта{% endtrans %}</label>
                <div currency-sel class="uk-form-controls">
                </div>
            </div>
            <div class="uk-margin">
                <label class="uk-form-label" for="for-horizontal-text">{% trans %}Описание{% endtrans %}</label>
                <div class="uk-form-controls">
                    <textarea name="description" required class="uk-textarea" rows=5></textarea>
                </div>
            </div>
            <div class="uk-margin">
                <label class="uk-form-label" for="for-horizontal-text">{% trans %}Фото{% endtrans %}</label>
                <div class="uk-form-controls">
                    <div uk-form-custom="target: true">
                        <input file-input ng-model="image" type="file">
                        <input class="uk-input uk-form-width-medium" type="text" placeholder="Выбрать файл">
                    </div>
                    <a ng-click="uploadImage()" class="uk-button uk-button-default">{% trans %}Загрузить{% endtrans %}</a>
                </div>
            </div>
            <div class="uk-margin" id="image_preview">
            </div>
            <div class="uk-margin">
                <button class="uk-button uk-button-primary uk-button-large" type="submit">{% trans %}Подать объявление{% endtrans %}</button>
            </div>
        </form>
    </div>
</div>
{% include 'footer.html.twig' %}
<script>
    var uploadUrl = "{{path('_upload_advert_image')}}";
    var session_id = "{{session_id}}";
    angular.module("agroov").directive("fileInput", function($http){
        return {
            link: function(scope, element,attr){
                scope.uploadImage = function(){
                    fd = new FormData();
                    console.log(element[0].files[0]);
                    fd.append('image', element[0].files[0]);
                    fd.append('session_id',scope.session_id);
                    $http.post(uploadUrl,fd,{
                        transformRequest: angular.identity,
                        headers: {'Content-Type': undefined,'UserSession' : session_id}
                    }).then(function(d){
                        console.log(d);

                        document.getElementById('image_preview').innerHTML += "<img src=" + "/uploads/tmp/" + session_id + "/small_" +  d.data + ">";
                    });
                }
            }
        };
    });

    /*var countryUrl = "{{path('_country')}}";
    angular.module('agroov').directive('countrySel',function(){
        return {
            templateUrl : countryUrl
        };
    });*/

    var currencyUrl = "{{path('_currency')}}";
    angular.module('agroov').directive('currencySel',function(){
        return {
            templateUrl : currencyUrl
        };
    });

    $('#country_id').change(function(){
        var url = "/region/" + $(this).val();
        var phonecode = $('option:selected', this).attr('data-phonecode');
        $('#phonecode').val("+"+phonecode);
    });

</script>
{% endblock%}
